import { useParams } from 'react-router-dom';
import products from './test/items.json';
import './ProductDetails.css';
import { useCartContext } from './App';

const ProductDetails = () => {
  const { cart, setCart } = useCartContext();
  const { id } = useParams();

  const product = products.find(product => product.id == id);

  function addTheItemToCartContext(productId) {
    const updatedCart = [...cart];
    const existingProductIndex = updatedCart.findIndex(cartItem => cartItem.id === productId);

    if (existingProductIndex >= 0) {
      updatedCart[existingProductIndex].quantity += 1;
    } else {
      updatedCart.push({ id: productId, quantity: 1 });
    }

    setCart(updatedCart);
    cart.map(id => {
      console.log(id)
    })
  }

  console.log(typeof cart)

  return (
    <div className="ProductDetails">
      <div id="productImgContainer">
        <img src={product.img} alt={product.name} />
      </div>

      <div id="mainProductDetails">
        <div id="sellerDetails">
          <div>{product.seller}</div>
          <h1>{product.name}</h1>

          <div id="ratingContainer">
            <div>Rating: {parseFloat(product.rating).toFixed(2)} ★</div><br />
            <div id="totalRatingContainer">Total ratings: {product.ratingTotal}</div>
          </div>
        </div>

        <div id="productDetails">
          <div>
            MRP: <s>₹{product.mrp}</s> (Including all taxes.) Discount: {product.discount}%
          </div>
          <div>Price: ₹{product.price}</div>
        </div>

        <div>
          Pay on delivery is available
          <br />
          Easy 14 days returns and exchanges
          <br />
          Try & Buy might be available depending on the product
        </div>

        <button id="addToCartButton" onClick={() => addTheItemToCartContext(product.id)}>
          Add to Cart
        </button>
      </div>
    </div>
  );
};

export default ProductDetails;